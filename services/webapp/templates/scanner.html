<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <script src="/static/js/jquery.min.js"></script>
    <script>
      const queryQRCode = async () => {
        /* Get member id */
        var qrtext = $('#scanform input[name=memberid]').val();
        memberid = qrtext.match(/\d*$/)[0];

        /* Fetch member data */
        const response = await fetch('/api/v1.0/member/' + memberid);
        const myJson = await response.json(); //extract JSON from the http response

        /* Inform user of status */
        console.log(myJson);
        $('#first_name').text(myJson['first_name']);
        $('#last_name').text(myJson['last_name']);
        $('#status_id').text(myJson['status_id']);

        /* Fetch events */
        // TODO: pull relevant for this location
        //    select events that:
        //        are in 1 of the selected locations
        //        starts in <= 2hrs
        //        is currently in session, or
        //        ended <= 2hrs ago
        //    sorted by abs(start_time - current_time)

        /* Ask user which event */
        // TODO: if more than 1 event is available
        //    make visible a 2nd selection of the events.

        /* Give the "OK, og ahead" signal */
        // TODO: make OK overlay visible, and clear
      }
    </script>
  </head>
  <body>
    <h1>QR Code Scanner</h1>
    <p>Scan your code here</p>
    <form id="scanform" onsubmit="queryQRCode(); return false;">
      <input name="memberid" type="text" size="35" />
      <input type="submit" />
    </form>
    <ul>
      <li>Name: <span id="first_name"></span> <span id="last_name"></span></li>
      <li>Status: <span id="status_id"></span></li>
    </ul>
    <form>

    </>
  </body>
</html>
